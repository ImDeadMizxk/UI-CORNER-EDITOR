<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enviar Ropa a Discord</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="https://i.imgur.com/HUhIujV.jpeg" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Aplicando la fuente Inter al cuerpo del documento */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Estilos para transiciones suaves */
        #notification, #imagePreviewContainer {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        /* Ocultar el input de archivo por defecto */
        #imageUpload {
            display: none;
        }
        /* Prevenir la selección y el arrastre de imágenes */
        img {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Sintaxis estándar */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-8 px-4">

    <div class="w-full max-w-lg mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <div class="flex flex-col items-center text-center mb-8">
                <!-- CORREGIDO: La imagen principal ahora es el botón "Subido" -->
                <img id="sendUploadButton" src="https://i.imgur.com/y5WqBp1.jpeg" alt="Enviar como Subido" title="Enviar como Subido" class="w-20 h-20 rounded-full mb-4 shadow-md object-cover cursor-pointer hover:scale-110 transition-transform duration-300">
                <h1 class="text-3xl font-bold text-gray-800">Clothing Bot</h1>
                <p class="text-gray-500">Envía prendas a tu canal de Discord.</p>
            </div>
            
            <div class="mb-4">
                <label for="message" class="sr-only">Mensaje</label>
                <textarea 
                    id="message" 
                    rows="4" 
                    class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 focus:outline-none text-gray-700 placeholder-gray-400 resize-none transition-colors"
                    placeholder="Describe la prenda o pega un enlace de Roblox..."
                ></textarea>
            </div>

            <div class="mb-4">
                <label for="imageUpload" class="w-full cursor-pointer bg-white border-2 border-dashed border-gray-300 hover:border-gray-400 hover:bg-gray-50 text-gray-500 font-semibold py-4 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-800 transition-colors duration-300 flex flex-col items-center justify-center text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mb-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                    <span>Subir una imagen</span>
                </label>
                <input type="file" id="imageUpload" accept="image/*">
            </div>

            <div id="imagePreviewContainer" class="mb-4 hidden relative opacity-0 transform scale-95">
                <img id="imagePreview" src="#" alt="" class="max-h-64 w-full object-contain rounded-lg border border-gray-200">
                <button id="removeImageButton" title="Quitar imagen" class="absolute top-2 right-2 bg-black/50 text-white rounded-full h-7 w-7 flex items-center justify-center font-bold hover:bg-black/75 transition-colors">&times;</button>
            </div>
            
            <!-- Botones de envío -->
            <div class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button id="sendShirtButton" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 flex items-center justify-center shadow-sm">
                        <span class="button-text">Enviar como Camisa</span>
                    </button>
                    <button id="sendPantsButton" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 flex items-center justify-center shadow-sm">
                        <span class="button-text">Enviar como Pantalón</span>
                    </button>
                </div>
            </div>

             <div id="loadingIndicator" class="hidden mt-6 flex items-center justify-center text-gray-500">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Enviando a Discord...</span>
            </div>
        </div>
        
        <div id="notification" class="fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-2"></div>
    </div>

    <script>
        // --- DOM Elements ---
        const messageTextarea = document.getElementById('message');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const removeImageButton = document.getElementById('removeImageButton');
        const sendShirtButton = document.getElementById('sendShirtButton');
        const sendPantsButton = document.getElementById('sendPantsButton');
        const sendUploadButton = document.getElementById('sendUploadButton'); // Ahora es la imagen principal
        const loadingIndicator = document.getElementById('loadingIndicator');
        const notification = document.getElementById('notification');
        
        // --- Webhook Configuration ---
        const shirtWebhookURL = 'https://discord.com/api/webhooks/1388257791088656394/CzyDrlhJBRaZ-B2Frt2Ca2Lt67_t2WoXJQBI52mLDGwrRuaZOzYFRzQOgJMelFFwRu6l';
        const pantsWebhookURL = 'https://discord.com/api/webhooks/1388257888077611058/Vbcsa7p8SpUEmYKPw6EzDQ0s4cLrqUHSOuLurc8END_5XFL_w-yev9NZctrIPoEydws0';
        const uploadWebhookURL = 'https://discord.com/api/webhooks/1388243649837666569/H25jj5XHMA_zcP7KbmPW3R1pImYJICakNVM4XI9wpiW63hMIoX4MV2_E51Kvb-U5ckrh'; // Nuevo webhook
        const botUsername = 'Clothing Bot';
        const botAvatarUrl = 'https://i.imgur.com/y5WqBp1.jpeg';

        let isSending = false;

        // --- Prevenir Interacción con Imágenes ---
        document.querySelectorAll('img').forEach(img => {
            // Permitir arrastrar la imagen de vista previa, pero no las demás
            if (img.id !== 'imagePreview') {
                img.setAttribute('draggable', 'false');
            }
            // Prevenir el menú contextual solo en las imágenes que no son de vista previa
            if (img.id !== 'imagePreview') {
                img.addEventListener('contextmenu', e => e.preventDefault());
            }
        });

        // --- Image Handling ---
        imageUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreviewContainer.classList.remove('hidden', 'opacity-0', 'scale-95');
                }
                reader.readAsDataURL(file);
            }
        });

        removeImageButton.addEventListener('click', function() {
            imageUpload.value = ''; // Clear the file input
            imagePreview.src = '#';
            imagePreviewContainer.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                imagePreviewContainer.classList.add('hidden');
            }, 300);
        });

        // --- Sending Logic ---
        sendShirtButton.addEventListener('click', () => sendMessage('CAMISA'));
        sendPantsButton.addEventListener('click', () => sendMessage('PANTALON'));
        sendUploadButton.addEventListener('click', () => sendMessage('SUBIDO')); 

        async function sendMessage(tag) {
            if (isSending) return;

            const originalMessage = messageTextarea.value.trim();
            const file = imageUpload.files[0];

            let processedMessage = originalMessage;
            const robloxUrlRegex = /(https?:\/\/www\.roblox\.com\/catalog\/\d+)/;
            const match = originalMessage.match(robloxUrlRegex);

            if (match && match[0]) {
                processedMessage = `<${match[0]}>`; 
            }

            if (!processedMessage && !file) {
                showNotification('Debes escribir un mensaje o subir una imagen.', true);
                return;
            }

            setLoading(true);
            
            // Determinar qué webhook y etiqueta usar
            let targetWebhookURL;
            let finalTag;

            if (tag === 'CAMISA') {
                targetWebhookURL = shirtWebhookURL;
                finalTag = '> ## **Shirt** [ 🥼 ]';
            } else if (tag === 'PANTALON') {
                targetWebhookURL = pantsWebhookURL;
                finalTag = '> ## **Pants** [ 👖 ]';
            } else if (tag === 'SUBIDO') {
                targetWebhookURL = uploadWebhookURL;
                finalTag = '> ## **Subido** [ 📤 ]';
            }
            
            let messagePart = '';
            if (processedMessage) {
                messagePart = ` ${processedMessage}`;
            }

            let finalContent = `${finalTag}${messagePart}`;

            if (file) {
                finalContent += "\n\u200b";
            }

            const formData = new FormData();
            const payload = {
                content: finalContent,
                username: botUsername,
                avatar_url: botAvatarUrl
            };
            
            formData.append('payload_json', JSON.stringify(payload));
            
            if (file) {
                formData.append('file1', file);
            }

            try {
                const response = await fetch(targetWebhookURL, {
                    method: 'POST',
                    body: formData,
                });

                if (response.ok) {
                    showNotification('¡Enviado con éxito!');
                    messageTextarea.value = '';
                    removeImageButton.click();
                } else {
                    const errorData = await response.json();
                    console.error('Discord Error:', errorData);
                    showNotification(`Error: ${response.status}. Revisa la consola.`, true);
                }
            } catch (error) {
                console.error('Network Error:', error);
                showNotification('Error de conexión. Revisa la consola.', true);
            } finally {
                setLoading(false);
            }
        }
        
        // --- UI Helper Functions ---
        function setLoading(isLoading) {
            isSending = isLoading;
            loadingIndicator.classList.toggle('hidden', !isLoading);
            
            // Deshabilitar botones y aplicar estilo de opacidad
            sendShirtButton.disabled = isLoading;
            sendPantsButton.disabled = isLoading;
            
            // Aplicar estilo visual a todos los botones, incluyendo la imagen
            [sendShirtButton, sendPantsButton, sendUploadButton].forEach(btn => {
                btn.classList.toggle('opacity-50', isLoading);
                btn.classList.toggle('pointer-events-none', isLoading);
            });
        }

        function showNotification(message, isError = false) {
            notification.textContent = message;
            notification.className = `fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl opacity-0 transform translate-y-2 ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            
            setTimeout(() => {
                notification.classList.remove('opacity-0', 'translate-y-2');
                notification.classList.add('opacity-100', 'translate-y-0');
            }, 10);

            setTimeout(() => {
                notification.classList.remove('opacity-100', 'translate-y-0');
                notification.classList.add('opacity-0', 'translate-y-2');
            }, 3000);
        }
    </script>
</body>
</html>
